<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="icon" type="image/png" href="/assets/logo-reefbluesky.png">
  <meta charset="UTF-8" />
  <title>ReefBlueSky - Sistema</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/dashboard-base.css">
  <style>


    .online-status-card {
      margin: 16px 24px 0 24px;
      padding: 16px 24px;
      border-radius: 12px;
      background: #020817;
      border: 1px solid #1f2937;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
    }

    .online-status-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .online-status-text {
      font-size: 14px;
      color: #9ca3af;
    }

    .online-status-online {
      color: #4ade80;
    }

    .online-status-offline {
      color: #f97373;
    }


    .content {
      flex: 1;
      padding: 12px 10px 16px;      /* igual main/config/graficos */
      display: grid;
      grid-template-columns: 1.4fr 1.6fr;
      gap: 16px;
    }
    @media (max-width: 960px) {
      .content { grid-template-columns: 1fr; }
    }
    .card {
      background: #020617;
      border-radius: 10px;
      padding: 16px;
      border: 1px solid #1f2937;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .card-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }
    .card-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .field-row {
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 13px;
    }
    .field-row span.label {
      color: #9ca3af;
      font-size: 12px;
    }
    .field-row span.value {
      color: #e5e7eb;
      font-size: 13px;
    }

    #deviceOnlineStatus {
      font-weight: 600;
    }

    .badge-online { color: #4ade80; }
    .badge-offline { color: #f97373; }

    .health-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
    .health-item {
      background: #020617;
      border-radius: 8px;
      border: 1px solid #1f2937;
      padding: 8px;
      font-size: 12px;
    }
    .health-label {
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .health-value {
      font-size: 14px;
      font-weight: 600;
    }
    .health-ok {
      color: #4ade80;
    }
    .health-warn {
      color: #facc15;
    }
    .health-bad {
      color: #f97373;
    }

    .btn-primary {
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .btn-primary:hover { filter: brightness(1.05); }

    .btn-danger {
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: #b91c1c;
      color: white;
    }
    .btn-danger:hover { filter: brightness(1.05); }

    /* [FIX] Estilos para alertas */
    .alert-item {
      background: #020617;
      border-radius: 8px;
      border-left: 4px solid;
      padding: 10px 12px;
      margin-bottom: 8px;
      font-size: 12px;
    }
    .alert-item-low {
      border-left-color: #60a5fa; /* azul */
      background: rgba(96, 165, 250, 0.05);
    }
    .alert-item-medium {
      border-left-color: #facc15; /* amarelo */
      background: rgba(250, 204, 21, 0.05);
    }
    .alert-item-high {
      border-left-color: #f97373; /* vermelho */
      background: rgba(249, 115, 115, 0.05);
    }
    .alert-item-critical {
      border-left-color: #b91c1c; /* vermelho escuro */
      background: rgba(185, 28, 28, 0.1);
    }
    .alert-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .alert-type {
      font-weight: 600;
      font-size: 13px;
      color: #e5e7eb;
    }
    .alert-severity {
      font-size: 11px;
      text-transform: uppercase;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .alert-severity-low {
      background: #60a5fa;
      color: #020617;
    }
    .alert-severity-medium {
      background: #facc15;
      color: #020617;
    }
    .alert-severity-high {
      background: #f97373;
      color: #fff;
    }
    .alert-severity-critical {
      background: #b91c1c;
      color: #fff;
    }
    .alert-message {
      color: #9ca3af;
      font-size: 12px;
      line-height: 1.4;
      margin-bottom: 4px;
    }
    .alert-timestamp {
      font-size: 11px;
      color: #6b7280;
    }

    .muted {
      color: #6b7280;
      font-size: 12px;
    }

    .events-list {
      max-height: 220px;
      overflow-y: auto;
      font-size: 12px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      padding: 8px;
    }
    .event-item {
      padding: 4px 0;
      border-bottom: 1px solid #111827;
    }
    .event-time {
      color: #9ca3af;
      margin-right: 4px;
    }
    .event-msg {
      color: #e5e7eb;
    }


  </style>
</head>
<body>
  <div id="topbar-root"></div>


  <!-- painel lateral -->
  <div id="sideMenu" class="side-menu">
    <button id="closeMenu" class="side-close">√ó</button>

    <!-- Submenu RBS KH -->
    <button class="side-submenu-toggle side-submenu-toggle-kh" type="button">
      RBS KH ‚ñæ
    </button>
    <div class="side-submenu side-submenu-kh">
      <a href="dashboard-main.html">Dashboard</a>
      <a href="dashboard-config.html">Configura√ß√µes</a>
      <a href="dashboard-sistema.html">Sistema</a>
    </div>

    <!-- GRUPO DOSADORA: t√≠tulo + submenu colaps√°vel -->
    <button class="side-submenu-toggle" type="button">
      Dosadora ‚ñæ
    </button>
    <div class="side-submenu">
      <a href="dashboard-dosing.html?tab=dashboard">Dashboard</a>
      <a href="dashboard-dosing.html?tab=agenda">Agenda</a>
      <a href="dashboard-dosing.html?tab=manual">Manual</a>
      <a href="dashboard-dosing.html?tab=config">Configura√ß√£o</a>
      <a href="dashboard-dosing.html?tab=calibration">Calibrar</a>
    </div>
    
    <a href="dashboard-logs.html">Dev</a>
    <a href="dashboard-account.html">Minha Conta</a>
    <a href="#" id="menuLogout">Sair</a>
  </div>

  <div class="online-status-card">
    <div class="online-status-title">Online status</div>
    <div id="onlineStatusText" class="online-status-text">
      Aguardando dados do dispositivo...
    </div>
  </div>


  <div class="content">
    <!-- Coluna esquerda: infos do device + sa√∫de -->
    <div style="display:flex; flex-direction:column; gap:16px;">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Informa√ß√µes do dispositivo</div>
        </div>
        <div class="card-subtitle">
          Dados b√°sicos do dispositivo selecionado.
        </div>

        <div class="field-row">
          <span class="label">Device ID</span>
          <span id="infoDeviceId" class="value">--</span>
        </div>
        <div class="field-row">
          <span class="label">Nome (fake ID)</span>
          <span id="infoDeviceName" class="value">--</span>
        </div>
        <div class="field-row">
          <span class="label">IP local</span>
          <span id="infoLocalIp" class="value">--</span>
        </div>
        <div class="field-row">
          <span class="label">√öltimo sinal (lastSeen)</span>
          <span id="infoLastSeen" class="value">--</span>
        </div>

        <div class="field-row">
          <span class="label">Status online</span>
          <span id="deviceOnlineStatus" class="value">--</span>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Sa√∫de do sistema</div>
        </div>
        <div class="card-subtitle">
          M√©tricas de CPU, mem√≥ria, armazenamento e Wi-Fi reportadas pelo dispositivo.
        </div>

        <div class="health-grid">
          <div class="health-item">
            <div class="health-label">CPU</div>
            <div id="healthCpu" class="health-value">--</div>
          </div>
          <div class="health-item">
            <div class="health-label">Mem√≥ria</div>
            <div id="healthMem" class="health-value">--</div>
          </div>
          <div class="health-item">
            <div class="health-label">Armazenamento</div>
            <div id="healthStorage" class="health-value">--</div>
          </div>
          <div class="health-item">
            <div class="health-label">Wi-Fi RSSI</div>
            <div id="healthWifi" class="health-value">--</div>
          </div>
          <div class="health-item">
            <div class="health-label">Uptime</div>
            <div id="healthUptime" class="health-value">--</div>
          </div>
        </div>

        <div id="healthStatusText" class="muted" style="margin-top:8px;">
          Aguardando dados de sa√∫de do dispositivo.
        </div>
      </div>

      <!-- [FIX] Card de Backup e Export -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">üì¶ Backup e Export</div>
        </div>
        <div class="card-subtitle">
          Exportar dados e fazer backup das configura√ß√µes.
        </div>

        <div style="display:flex; flex-direction:column; gap:8px; font-size:13px; margin-top:12px;">
          <button id="exportMeasurementsBtn" class="btn-primary">
            üìä Exportar Medi√ß√µes (CSV)
          </button>
          <button id="backupConfigBtn" class="btn-primary">
            üíæ Backup Configura√ß√µes (JSON)
          </button>
          <div style="margin-top:4px;">
            <label for="importConfigFile" class="btn-primary" style="display:inline-block; cursor:pointer; text-align:center;">
              üì• Importar Configura√ß√µes
            </label>
            <input type="file" id="importConfigFile" accept=".json" style="display:none;">
          </div>
        </div>

        <div id="backupStatus" class="muted" style="margin-top:8px;">
          Clique nos bot√µes acima para exportar/importar dados.
        </div>
      </div>
    </div>

    <!-- Coluna direita: comandos e eventos -->
    <div style="display:flex; flex-direction:column; gap:16px;">
      <div class="card">
        <div class="card-header">
          <div class="card-title">A√ß√µes de manuten√ß√£o</div>
        </div>
        <div class="card-subtitle">
          Comandos remotos enviados para o dispositivo via backend.
        </div>

        <div style="display:flex; flex-direction:column; gap:8px; font-size:13px;">
          <button id="cmdRestart" class="btn-primary">
            Reiniciar dispositivo
          </button>
          <button id="cmdResetKh" class="btn-primary">
            Resetar estado de KH (recalibrar l√≥gica interna)
          </button>
          <button id="cmdFactoryReset" class="btn-danger">
            Reset de f√°brica (apaga hist√≥rico e configura√ß√µes)
          </button>
        </div>

        <div id="cmdStatus" class="muted" style="margin-top:8px;">
          Nenhum comando enviado ainda.
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Eventos recentes</div>
        </div>
        <div class="card-subtitle">
          Pequeno hist√≥rico de eventos e alertas do dispositivo.
        </div>

        <div id="eventsList" class="events-list">
          <div class="muted">Nenhum evento carregado ainda.</div>
        </div>
      </div>

      <!-- [FIX] Card de Alertas Recentes -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">üö® Alertas Recentes</div>
        </div>
        <div class="card-subtitle">
          Hist√≥rico de alertas de calibra√ß√£o, erros e avisos do sistema (enviados via Telegram/Email).
        </div>

        <div id="alertsList" class="events-list" style="max-height: 300px; overflow-y: auto;">
          <div class="muted">Nenhum alerta registrado ainda.</div>
        </div>
      </div>
    </div>
  </div>

  <div id="footer-root"></div>
  
  <script src="js/dashboard-common.js"></script>
  <script src="js/dashboard-sistema.js"></script>

</body>
</html>
