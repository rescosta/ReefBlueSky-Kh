# ============================================================================
# ReefBlueSky KH Monitor - Display Client for ESP32-C6-LCD-1.47
# PlatformIO Configuration
# ============================================================================

[env:esp32c6]
platform = espressif32@6.5.0
board = esp32-c6-devkitc-1
framework = arduino

platform_packages =
  framework-arduinoespressif32@^3.0.0
monitor_speed = 115200

# ============================================================================
# [LIBRARIES] Dependências do Projeto
# ============================================================================
lib_deps =
    
    # Core Libraries
    WiFi
    WebServer
    HTTPClient
    SPIFFS
    
    # JSON Processing
    ArduinoJson@^6.21.4
    
    # Display Driver
    bodmer/TFT_eSPI @ ^2.5.0
    
    # Graphics
    adafruit/Adafruit GFX Library@^1.11.9
    adafruit/Adafruit BusIO@^1.14.1
    adafruit/Adafruit NeoPixel @ ^1.12.0
    
    # Utilities
    paulstoffregen/OneWire@^2.3.8
    milesburton/DallasTemperature@^3.9.1

# ============================================================================
# [BUILD FLAGS] Configurações do Compilador e TFT_eSPI
# ============================================================================
build_flags =
    # === COMPILER FLAGS ===
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -std=gnu++17
    -Wall
    -Wextra
    
    # === TFT_eSPI CONFIGURATION ===
    # User Setup (previne conflito com arquivo User_Setup.h)
    -DUSER_SETUP_LOADED=1
    
    # === DISPLAY DRIVER ===
    # ST7789 é o controlador típico para LCD 1.47" (128x280)
    -DST7789_DRIVER=1
    
    # === DISPLAY RESOLUTION ===
    -DTFT_WIDTH=128
    -DTFT_HEIGHT=280
    -DTFT_ROTATION=0
    
    # === SPI PIN MAPPING (ESP32-C6-LCD-1.47) ===
    # Ajuste conforme o pinout do seu módulo:
    # GPIO7  = MOSI (SPI Data In)
    # GPIO6  = SCLK (SPI Clock)
    # GPIO10 = CS   (Chip Select)
    # GPIO2  = DC   (Data/Command)
    # GPIO3  = RST  (Reset)
    # GPIO8  = BL   (Backlight)
    -DTFT_MOSI=7
    -DTFT_SCLK=6
    -DTFT_CS=10
    -DTFT_DC=2
    -DTFT_RST=3
    -DTFT_BL=8
    -DTFT_BACKLIGHT_ON=HIGH
    
    # === SPI FREQUENCY ===
    -DSPI_FREQUENCY=40000000
    -DSPI_READ_FREQUENCY=20000000
    -DSPI_TOUCH_FREQUENCY=2500000
    
    # === FONT CONFIGURATION ===
    -DLOAD_GLCD=1
    -DLOAD_FONT2=1
    -DLOAD_FONT4=1
    -DLOAD_FONT6=1
    -DLOAD_FONT7=1
    -DLOAD_FONT8=1
    -DSMOOTH_FONT=1
    
    # === MEMORY OPTIMIZATION ===
    -DUSE_DMA=1
    -DUSE_DMA_TO_TFT=1
    
    # === COMPATIBILITY FLAGS ===
    -DARDUINO_ESP32=1
    -DESP32=1
    -DESP_PLATFORM=1

# ============================================================================
# [UPLOAD] Configurações de Upload
# ============================================================================
upload_speed = 921600
upload_port = /dev/ttyUSB0
upload_protocol = esptool
upload_resetmethod = ck

# Uncomment if using macOS (usually /dev/cu.usbserial-*)
# upload_port = /dev/cu.usbserial-0001

# Uncomment if using Windows (usually COM3 or COM4)
# upload_port = COM3

# ============================================================================
# [MONITOR] Configurações do Monitor Serial
# ============================================================================
monitor_port = /dev/ttyUSB0
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    time
    log2file
monitor_echo = yes

# ============================================================================
# [DEBUG] Configurações de Debug (Opcional)
# ============================================================================
debug_tool = esp-prog
debug_speed = 20000
debug_init_break = tbreak setup

# ============================================================================
# [MEMORY] Configurações de Memória
# ============================================================================
# Partition scheme: Large SPIFFS or Large APP (default já é otimizado)
board_build.partitions = huge_app.csv

# ============================================================================
# [COMPILER OPTIONS] Otimizações
# ============================================================================
build_type = release
build_unflags = 
    -Os
    -flto
build_flags =
    ${env:esp32-c6.build_flags}
    -O2

# ============================================================================
# [FRAMEWORK] Arduino Framework Options
# ============================================================================
framework_version = 5.3.0

# ============================================================================
# [PROJECT METADATA]
# ============================================================================
# Nome do projeto
[platformio]
name = ReefBlueSky KH Monitor Display Client
description = Display interface for ReefBlueSky KH measurement device using ESP32-C6 and 1.47" LCD
version = 1.0.0

# ============================================================================
# NOTAS IMPORTANTES:
# ============================================================================
# 1. Verifique os pinos conforme o esquemático do seu ESP32-C6-LCD-1.47
#    Se for diferente, ajuste os valores em "SPI PIN MAPPING"
#
# 2. Porta USB:
#    - Linux: /dev/ttyUSB0
#    - macOS: /dev/cu.usbserial-* (varie conforme o adaptador)
#    - Windows: COM3, COM4, etc.
#
# 3. Se o display não aparecer, tente:
#    - Aumentar DTFT_ROTATION para 1, 2, ou 3
#    - Trocar ST7789_DRIVER para GC9A01_DRIVER (se controller for diferente)
#    - Reduzir SPI_FREQUENCY para 20000000 ou 10000000
#
# 4. Para mais detalhes sobre TFT_eSPI:
#    https://github.com/Bodmer/TFT_eSPI/tree/master/User_Setups
#
# ============================================================================
